<!DOCTYPE html>
<html lang="zh" dir="ltr"><head><title>202304230920</title><meta charset="utf-8"/><link rel="preconnect" href="https://ik.imagekit.io/fonts131" crossorigin="anonymous"/><link rel="stylesheet" href="https://ik.imagekit.io/fonts131/packages/jhlst/dist/%E4%BA%AC%E8%8F%AF%E8%80%81%E5%AE%8B%E4%BD%93v1_007/result.css"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Learn2Live"/><meta property="og:title" content="202304230920"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="202304230920"/><meta name="twitter:description" content="Just see: cmake_minimum_required(VERSION 3.15) project(ClickHouse LANGUAGES C CXX ASM) set(CMAKE_THREAD_LIBS_INIT &quot;-lpthread&quot;) set(CMAKE_HAVE_THREADS_LIBRARY 1) set(CMAKE_USE_WIN32_THREADS_INIT 0) set(CMAKE_USE_PTHREADS_INIT 1) set(THREADS_PREFER_PTHREAD_FLAG ON) set(CMAKE_INCLUDE_DIRECTOR..."/><meta property="og:description" content="Just see: cmake_minimum_required(VERSION 3.15) project(ClickHouse LANGUAGES C CXX ASM) set(CMAKE_THREAD_LIBS_INIT &quot;-lpthread&quot;) set(CMAKE_HAVE_THREADS_LIBRARY 1) set(CMAKE_USE_WIN32_THREADS_INIT 0) set(CMAKE_USE_PTHREADS_INIT 1) set(THREADS_PREFER_PTHREAD_FLAG ON) set(CMAKE_INCLUDE_DIRECTOR..."/><meta property="og:image:alt" content="Just see: cmake_minimum_required(VERSION 3.15) project(ClickHouse LANGUAGES C CXX ASM) set(CMAKE_THREAD_LIBS_INIT &quot;-lpthread&quot;) set(CMAKE_HAVE_THREADS_LIBRARY 1) set(CMAKE_USE_WIN32_THREADS_INIT 0) set(CMAKE_USE_PTHREADS_INIT 1) set(THREADS_PREFER_PTHREAD_FLAG ON) set(CMAKE_INCLUDE_DIRECTOR..."/><meta property="og:image" content="https://guyueshui.github.io/quartz/static/og-image.png"/><meta property="og:image:url" content="https://guyueshui.github.io/quartz/static/og-image.png"/><meta name="twitter:image" content="https://guyueshui.github.io/quartz/static/og-image.png"/><meta property="og:image:type" content="image/.png"/><meta property="twitter:domain" content="guyueshui.github.io/quartz"/><meta property="og:url" content="https://guyueshui.github.io/quartz/__zettel/202304230920-cmake-learn"/><meta property="twitter:url" content="https://guyueshui.github.io/quartz/__zettel/202304230920-cmake-learn"/><meta name="description" content="Just see: cmake_minimum_required(VERSION 3.15) project(ClickHouse LANGUAGES C CXX ASM) set(CMAKE_THREAD_LIBS_INIT &quot;-lpthread&quot;) set(CMAKE_HAVE_THREADS_LIBRARY 1) set(CMAKE_USE_WIN32_THREADS_INIT 0) set(CMAKE_USE_PTHREADS_INIT 1) set(THREADS_PREFER_PTHREAD_FLAG ON) set(CMAKE_INCLUDE_DIRECTOR..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvcXVhcnR6L3F1YXJ0ei9xdWFydHovY29tcG9uZW50cy9zdHlsZXMiLCJzb3VyY2VzIjpbIm1lcm1haWQuaW5saW5lLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUdGO0VBQ0U7OztBQUtGO0VBQ0U7RUFDQTs7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTs7QUFHRjtFQUNFO0VBQ0E7O0FBSUo7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7O0FBSUY7RUFDRTtFQUNBO0VBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIuZXhwYW5kLWJ1dHRvbiB7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxvYXQ6IHJpZ2h0O1xuICBwYWRkaW5nOiAwLjRyZW07XG4gIG1hcmdpbjogMC4zcmVtO1xuICByaWdodDogMDsgLy8gTk9URTogcmlnaHQgd2lsbCBiZSBzZXQgaW4gbWVybWFpZC5pbmxpbmUudHNcbiAgY29sb3I6IHZhcigtLWdyYXkpO1xuICBib3JkZXItY29sb3I6IHZhcigtLWRhcmspO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gIGJvcmRlcjogMXB4IHNvbGlkO1xuICBib3JkZXItcmFkaXVzOiA1cHg7XG4gIG9wYWNpdHk6IDA7XG4gIHRyYW5zaXRpb246IDAuMnM7XG5cbiAgJiA+IHN2ZyB7XG4gICAgZmlsbDogdmFyKC0tbGlnaHQpO1xuICAgIGZpbHRlcjogY29udHJhc3QoMC4zKTtcbiAgfVxuXG4gICY6aG92ZXIge1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICBib3JkZXItY29sb3I6IHZhcigtLXNlY29uZGFyeSk7XG4gIH1cblxuICAmOmZvY3VzIHtcbiAgICBvdXRsaW5lOiAwO1xuICB9XG59XG5cbnByZSB7XG4gICY6aG92ZXIgPiAuZXhwYW5kLWJ1dHRvbiB7XG4gICAgb3BhY2l0eTogMTtcbiAgICB0cmFuc2l0aW9uOiAwLjJzO1xuICB9XG59XG5cbiNtZXJtYWlkLWNvbnRhaW5lciB7XG4gIHBvc2l0aW9uOiBmaXhlZDtcbiAgY29udGFpbjogbGF5b3V0O1xuICB6LWluZGV4OiA5OTk7XG4gIGxlZnQ6IDA7XG4gIHRvcDogMDtcbiAgd2lkdGg6IDEwMHZ3O1xuICBoZWlnaHQ6IDEwMHZoO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBkaXNwbGF5OiBub25lO1xuICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoNHB4KTtcbiAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjUpO1xuXG4gICYuYWN0aXZlIHtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIH1cblxuICAmID4gI21lcm1haWQtc3BhY2Uge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICAgIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgdG9wOiA1MCU7XG4gICAgbGVmdDogNTAlO1xuICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xuICAgIGhlaWdodDogODB2aDtcbiAgICB3aWR0aDogODB2dztcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuXG4gICAgJiA+IC5tZXJtYWlkLWNvbnRlbnQge1xuICAgICAgcGFkZGluZzogMnJlbTtcbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IDAgMDtcbiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjFzIGVhc2U7XG4gICAgICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgICAgIG1pbi1oZWlnaHQ6IDIwMHB4O1xuICAgICAgbWluLXdpZHRoOiAyMDBweDtcblxuICAgICAgcHJlIHtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICB9XG5cbiAgICAgIHN2ZyB7XG4gICAgICAgIG1heC13aWR0aDogbm9uZTtcbiAgICAgICAgaGVpZ2h0OiBhdXRvO1xuICAgICAgfVxuICAgIH1cblxuICAgICYgPiAubWVybWFpZC1jb250cm9scyB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBib3R0b206IDIwcHg7XG4gICAgICByaWdodDogMjBweDtcbiAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICBnYXA6IDhweDtcbiAgICAgIHBhZGRpbmc6IDhweDtcbiAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgICBib3gtc2hhZG93OiAwIDJweCA0cHggcmdiYSgwLCAwLCAwLCAwLjEpO1xuICAgICAgei1pbmRleDogMjtcblxuICAgICAgLm1lcm1haWQtY29udHJvbC1idXR0b24ge1xuICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgd2lkdGg6IDMycHg7XG4gICAgICAgIGhlaWdodDogMzJweDtcbiAgICAgICAgcGFkZGluZzogMDtcbiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHQpO1xuICAgICAgICBjb2xvcjogdmFyKC0tZGFyayk7XG4gICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgICBmb250LXNpemU6IDE2cHg7XG4gICAgICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1ib2R5Rm9udCk7XG4gICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGVhc2U7XG5cbiAgICAgICAgJjpob3ZlciB7XG4gICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgICAgfVxuXG4gICAgICAgICY6YWN0aXZlIHtcbiAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMXB4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0eWxlIHRoZSByZXNldCBidXR0b24gZGlmZmVyZW50bHlcbiAgICAgICAgJjpudGgtY2hpbGQoMikge1xuICAgICAgICAgIHdpZHRoOiBhdXRvO1xuICAgICAgICAgIHBhZGRpbmc6IDAgMTJweDtcbiAgICAgICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ== */</style><link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://guyueshui.github.io/quartz/index.xml"/></head><body data-slug="__zettel/202304230920-cmake-learn"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="..">Learn2Live</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>搜索</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="搜索些什么" placeholder="搜索些什么"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="暗色模式"><title>暗色模式</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="亮色模式"><title>亮色模式</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="阅读模式"><title>阅读模式</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>!new Set([\&quot;assets\&quot;,\&quot;tags\&quot;,\&quot;advanced\&quot;]).has(node.displayName.toLowerCase())&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-228"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>探索</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-228" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../__zettel/">__zettel</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>202304230920 cmake learn</a></div></nav><h1 class="article-title">202304230920</h1><p show-comma="true" class="content-meta"><time datetime="2023-04-23T01:20:26.000Z">2023年4月23日</time><span>17分钟阅读</span></p><ul class="tags"><li><a href="../tags/cmake" class="internal tag-link">cmake</a></li></ul></div></div><article class="popover-hint"><p>Just see:</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="cmake" data-theme="github-light github-dark"><code data-language="cmake" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cmake_minimum_required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3.15)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ClickHouse LANGUAGES C CXX ASM)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_THREAD_LIBS_INIT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-lpthread&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_HAVE_THREADS_LIBRARY 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_USE_WIN32_THREADS_INIT 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_USE_PTHREADS_INIT 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(THREADS_PREFER_PTHREAD_FLAG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_INCLUDE_DIRECTORIES_BEFORE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/libcxx/include/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64/x86_64-linux-gnu/libc/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64/x86_64-linux-gnu/libc/usr/include/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64/x86_64-linux-gnu/libc/usr/include/linux/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64/x86_64-linux-gnu/libc/usr/include/x86_64-linux-gnu/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64-musl/include/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./contrib/sysroot/linux-x86_64-musl/lib/gcc/x86_64-linux-musl/10/include/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/lib/gcc/x86_64-linux-gnu/10.3.1/include/</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If turned off: e.g. when ENABLE_FOO is ON, but FOO tool was not found, the CMake will continue.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(FAIL_ON_UNSUPPORTED_OPTIONS_COMBINATION</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   &quot;Stop/Fail CMake configuration if some ENABLE_XXX option is defined (either ON or OFF)</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   but is not possible to satisfy&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(FAIL_ON_UNSUPPORTED_OPTIONS_COMBINATION)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RECONFIGURE_MESSAGE_LEVEL FATAL_ERROR)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RECONFIGURE_MESSAGE_LEVEL WARNING)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/arch.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/tools.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/ccache.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/clang_tidy.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/git_status.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ignore export() since we don't use it,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># but it gets broken with a global targets via link_libraries()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">macro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (export)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endmacro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_EXPORT_COMPILE_COMMANDS 1) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Write compile_commands.json</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_LINK_DEPENDS_NO_SHARED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 1) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Do not relink all depended targets on .so</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CONFIGURATION_TYPES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RelWithDebInfo;Debug;Release;MinSizeRel&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STRING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FORCE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_DEBUG_POSTFIX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;d&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STRING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Generate debug library name with a postfix.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># To be consistent with CMakeLists from contrib libs.</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable the ability to organize targets into hierarchies of &quot;folders&quot; for capable GUI-based IDEs.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For more info see https://cmake.org/cmake/help/latest/prop_gbl/USE_FOLDERS.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GLOBAL PROPERTY </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">USE_FOLDERS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Check that submodules are present</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${ClickHouse_SOURCE_DIR}/contrib/sysroot/README.md&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (FATAL_ERROR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Submodules are not initialized. Run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">git submodule update --init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Take care to add prlimit in command line before ccache, or else ccache thinks that</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prlimit is compiler, and clang++ is its input file, and refuses to work  with</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># multiple inputs, e.g in ccache log:</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [2021-03-31T18:06:32.655327 36900] Command line: /usr/bin/ccache prlimit --as=10000000000 --data=5000000000 --cpu=600 /usr/bin/clang++-11 - ...... std=gnu++2a -MD -MT src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o -MF src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o.d -o src/CMakeFiles/dbms.dir/Storages/MergeTree/IMergeTreeDataPart.cpp.o -c ../src/Storages/MergeTree/IMergeTreeDataPart.cpp</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [2021-03-31T18:06:32.656704 36900] Multiple input files: /usr/bin/clang++-11 and ../src/Storages/MergeTree/IMergeTreeDataPart.cpp</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Another way would be to use --ccache-skip option before clang++-11 to make</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ccache ignore it.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_CHECK_HEAVY_BUILDS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Don't allow C++ translation units to compile too long or to take too much memory while compiling.&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_CHECK_HEAVY_BUILDS)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # set DATA (since RSS does not work since 2.6.x+) to 5G</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (RLIMIT_DATA 5000000000)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # set VIRT (RLIMIT_AS) to 10G (DATA*10)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (RLIMIT_AS 10000000000)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # set CPU time limit to 1000 seconds</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (RLIMIT_CPU 1000)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # gcc10/gcc10/clang -fsanitize=memory is too heavy</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (SANITIZE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_GCC)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (RLIMIT_DATA 10000000000) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 10G</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_CXX_COMPILER_LAUNCHER prlimit --as=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RLIMIT_AS}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --data=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RLIMIT_DATA}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --cpu=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RLIMIT_CPU}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_CXX_COMPILER_LAUNCHER}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> CMAKE_BUILD_TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OR</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> CMAKE_BUILD_TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;None&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_BUILD_TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RelWithDebInfo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMAKE_BUILD_TYPE is not set, set to default = ${CMAKE_BUILD_TYPE}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMAKE_BUILD_TYPE: ${CMAKE_BUILD_TYPE}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (TOUPPER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${CMAKE_BUILD_TYPE}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(USE_STATIC_LIBRARIES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disable to use shared libraries&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># DEVELOPER ONLY.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Faster linking if turned on.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SPLIT_SHARED_LIBRARIES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Keep all internal libraries as separate .so files&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_STATIC_LIBRARIES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SPLIT_SHARED_LIBRARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(FATAL_ERROR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SPLIT_SHARED_LIBRARIES=1 must not be used together with USE_STATIC_LIBRARIES=1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USE_STATIC_LIBRARIES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SPLIT_SHARED_LIBRARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">BUILD_SHARED_LIBS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INTERNAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_STATIC_LIBRARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(REVERSE </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_FIND_LIBRARY_SUFFIXES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_FUZZING </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fuzzy testing using libfuzzer&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_FUZZING)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Also set WITH_COVERAGE=1 for better fuzzing process</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # By default this is disabled, because fuzzers are built in CI with the clickhouse itself.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # And we don't want to enable coverage for it.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fuzzing instrumentation enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (FUZZER </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;libfuzzer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -nostdlib++&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_CLICKHOUSE_ODBC_BRIDGE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_LIBRARIES 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_SSL 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_UNWIND </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_EMBEDDED_COMPILER 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_EXAMPLES 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_UTILS 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_THINLTO 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_TCMALLOC 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_JEMALLOC 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_CHECK_HEAVY_BUILDS 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GLIBC_COMPATIBILITY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # For codegen_select_fuzzer</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_PROTOBUF 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Global libraries</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># See:</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - default_libs.cmake</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - sanitize.cmake</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_library</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global-libs </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INTERFACE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/fuzzer.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/sanitize.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_COLORED_BUILD </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable colors in compiler output&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_COLOR_MAKEFILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${ENABLE_COLORED_BUILD}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># works only for the makefile generator</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_COLORED_BUILD </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> CMAKE_GENERATOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Ninja&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Turn on colored output. https://github.com/ninja-build/ninja/wiki/FAQ</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fdiagnostics-color=always&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS} -fdiagnostics-color=always&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... such manually setting of flags can be removed once CMake supports a variable to</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # activate colors in *all* build systems: https://gitlab.kitware.com/cmake/cmake/-/issues/15502</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/check_flags.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/add_warning.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # generate ranges for fast &quot;addr2line&quot; search</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RELEASE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -gdwarf-aranges&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (HAS_USE_CTOR_HOMING)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # For more info see https://blog.llvm.org/posts/2021-04-05-constructor-homing-for-debug-info/</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DEBUG&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RELWITHDEBINFO&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -Xclang -fuse-ctor-homing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS} -Xclang -fuse-ctor-homing&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_warning(enum-constexpr-conversion) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># breaks Protobuf in clang-16</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If compiler has support for -Wreserved-identifier. It is difficult to detect by clang version,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># because there are two different branches of clang: clang and AppleClang.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (AppleClang is not supported by ClickHouse, but some developers have misfortune to use it).</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (HAS_RESERVED_IDENTIFIER)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_compile_definitions (HAS_RESERVED_IDENTIFIER)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If turned `ON`, assumes the user has either the system GTest library or the bundled one.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_TESTS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Provide unit_test_dbms target with Google.Test unit tests&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_EXAMPLES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Build all example programs in 'examples' subdirectories&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_LINUX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ARCH_AMD64 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ARCH_AARCH64) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USE_STATIC_LIBRARIES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SPLIT_SHARED_LIBRARIES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USE_MUSL)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Only for Linux, x86_64 or aarch64.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GLIBC_COMPATIBILITY </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable compatibility with older glibc libraries.&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GLIBC_COMPATIBILITY)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RECONFIGURE_MESSAGE_LEVEL}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Glibc compatibility cannot be enabled in current configuration&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Make sure the final executable has symbols exported</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} -rdynamic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_DARWIN)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # The `-all_load` flag forces loading of all symbols from all libraries,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # and leads to multiply-defined symbols. This flag allows force loading</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # from a _specific_ library, which is what we need.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WHOLE_ARCHIVE -force_load)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # The `-noall_load` flag is the default and now obsolete.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NO_WHOLE_ARCHIVE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-undefined,error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Effectively, a no-op. Here to avoid empty &quot;-Wl, &quot; sequence to be generated in the command line.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WHOLE_ARCHIVE --whole-archive)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NO_WHOLE_ARCHIVE --no-whole-archive)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_CURL_BUILD </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable curl, azure, sentry build on by default except MacOS.&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_DARWIN)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Disable the curl, azure, senry build on MacOS</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_CURL_BUILD </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ignored if `lld` is used</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ADD_GDB_INDEX_FOR_GOLD </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Add .gdb-index to resulting binaries for gold linker.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RELEASE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Can be lld or ld-lld.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LINKER_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lld$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} -Wl,--gdb-index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_SHARED_LINKER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_SHARED_LINKER_FLAGS} -Wl,--gdb-index&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Adding .gdb-index via --gdb-index linker option.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # we use another tool for gdb-index, because gold linker removes section .debug_aranges, which used inside clickhouse stacktraces</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # http://sourceware-org.1504.n7.nabble.com/gold-No-debug-aranges-section-when-linking-with-gdb-index-td540965.html#a556932</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LINKER_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gold$&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ADD_GDB_INDEX_FOR_GOLD)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        find_program</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GDB_ADD_INDEX_EXE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NAMES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gdb-add-index&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DOC</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Path to gdb-add-index executable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GDB_ADD_INDEX_EXE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_GDB_ADD_INDEX 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (WARNING </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cannot add gdb index to binaries, because gold linker is used, but gdb-add-index executable not found.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_GDB_ADD_INDEX 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gdb-add-index found: ${GDB_ADD_INDEX_EXE}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RELEASE&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;RELWITHDEBINFO&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MINSIZEREL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OMIT_HEAVY_DEBUG_SYMBOLS_DEFAULT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OMIT_HEAVY_DEBUG_SYMBOLS_DEFAULT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Provides faster linking and lower binary size.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tradeoff is the inability to debug some source files with e.g. gdb</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (empty stack frames and no local variables).&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(OMIT_HEAVY_DEBUG_SYMBOLS</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Do not generate debugger info for heavy modules (ClickHouse functions and dictionaries, some contrib)&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ${OMIT_HEAVY_DEBUG_SYMBOLS_DEFAULT}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(USE_DEBUG_HELPERS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(USE_DEBUG_HELPERS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable debug helpers&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${USE_DEBUG_HELPERS}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_STANDALONE_KEEPER </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Build keeper as small standalone binary&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BUILD_STANDALONE_KEEPER)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CREATE_KEEPER_SYMLINK </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Create symlink for clickhouse-keeper to main server binary&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CREATE_KEEPER_SYMLINK </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Create symlink for clickhouse-keeper to main server binary&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create BuildID when using lld. For other linkers it is created by default.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LINKER_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;lld$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # SHA1 is not cryptographically secure but it is the best what lld is offering.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} -Wl,--build-id=sha1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add a section with the hash of the compiled machine code for integrity checks.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Only for official builds, because adding a section can be time consuming (rewrite of several GB).</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># And cross compiled binaries are not supported (since you cannot execute clickhouse hash-binary)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CLICKHOUSE_OFFICIAL_BUILD </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_TOOLCHAIN_FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CMAKE_TOOLCHAIN_FILE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;linux/toolchain-x86_64.cmake$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Official build: A checksum hash will be added to the clickhouse executable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_BINARY_HASH 1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STRING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Calculate binary hash and store it in the separate section&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;No official build: A checksum hash will not be added to the clickhouse executable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Optionally split binaries and debug symbols.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SPLIT_DEBUG_SYMBOLS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Split binaries and debug symbols&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (SPLIT_DEBUG_SYMBOLS)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Will split binaries and debug symbols&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SPLITTED_DEBUG_SYMBOLS_DIR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;stripped&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STRING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;A separate directory for stripped information&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cmake_host_system_information</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RESULT AVAILABLE_PHYSICAL_MEMORY QUERY AVAILABLE_PHYSICAL_MEMORY) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Not available under freebsd</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AVAILABLE_PHYSICAL_MEMORY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AVAILABLE_PHYSICAL_MEMORY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GREATER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 8000)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Less `/tmp` usage, more RAM usage.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_PIPE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-pipe compiler option&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_PIPE)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -pipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disabling compiler -pipe option (have only ${AVAILABLE_PHYSICAL_MEMORY} mb of memory)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cmake/cpu_features.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Asynchronous unwind tables are needed for Query Profiler.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># They are already by default on some platforms but possibly not on all platforms.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable it explicitly.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -fasynchronous-unwind-tables&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reproducible builds.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_BUILD_TYPE_UC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DEBUG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PATH_MAPPING_DEFAULT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PATH_MAPPING_DEFAULT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PATH_MAPPING </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable remapping of file source paths in debug info, predefined preprocessor macros, and __builtin_FILE(). It's used to generate reproducible builds. See https://reproducible-builds.org/docs/build-path&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${ENABLE_BUILD_PATH_MAPPING_DEFAULT}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PATH_MAPPING)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -ffile-prefix-map=${CMAKE_SOURCE_DIR}=.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_ASM_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_ASM_FLAGS} -ffile-prefix-map=${CMAKE_SOURCE_DIR}=.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PROFILING </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable profiling of build time&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_BUILD_PROFILING)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -ftime-trace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RECONFIGURE_MESSAGE_LEVEL}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Build profiling is only available with CLang&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_CXX_STANDARD 20)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_CXX_EXTENSIONS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Same as gnu++2a (ON) vs c++2a (OFF): https://cmake.org/cmake/help/latest/prop_tgt/CXX_EXTENSIONS.html</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_CXX_STANDARD_REQUIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_STANDARD 11)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_EXTENSIONS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_STANDARD_REQUIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_GCC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Enable C++14 sized global deallocation functions. It should be enabled by setting -std=c++14 but I'm not sure.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fsized-deallocation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># falign-functions=32 prevents from random performance regressions with the code change. Thus, providing more stable</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># benchmarks.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_GCC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -falign-functions=32&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ARCH_AMD64)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # align branches within a 32-Byte boundary to avoid the potential performance loss when code layout change,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # which makes benchmark results more stable.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BRANCHES_WITHIN_32B_BOUNDARIES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-mbranches-within-32B-boundaries&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_GCC)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # gcc is in assembler, need to add &quot;-Wa,&quot; prefix</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BRANCHES_WITHIN_32B_BOUNDARIES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-Wa,${BRANCHES_WITHIN_32B_BOUNDARIES}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CheckCXXCompilerFlag)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    check_cxx_compiler_flag(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${BRANCHES_WITHIN_32B_BOUNDARIES}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HAS_BRANCHES_WITHIN_32B_BOUNDARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (HAS_BRANCHES_WITHIN_32B_BOUNDARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} ${BRANCHES_WITHIN_32B_BOUNDARIES}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_GCC)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fcoroutines&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Compiler-specific coverage flags e.g. -fcoverage-mapping for gcc</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WITH_COVERAGE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Profile the resulting binary/binaries&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (WITH_COVERAGE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -fprofile-instr-generate -fcoverage-mapping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # If we want to disable coverage for specific translation units</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WITHOUT_COVERAGE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-fno-profile-instr-generate -fno-coverage-mapping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (WITH_COVERAGE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_GCC)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS} -fprofile-arcs -ftest-coverage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COVERAGE_OPTION </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-lgcov&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WITHOUT_COVERAGE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-fno-profile-arcs -fno-test-coverage&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${COMPILER_FLAGS}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Our built-in unwinder only supports DWARF version up to 4.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (DEBUG_INFO_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-g -gdwarf-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                     &quot;${CMAKE_CXX_FLAGS} ${COMPILER_FLAGS}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS_RELWITHDEBINFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &quot;${CMAKE_CXX_FLAGS_RELWITHDEBINFO} -O3 ${DEBUG_INFO_FLAGS} ${CMAKE_CXX_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS_DEBUG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">               &quot;${CMAKE_CXX_FLAGS_DEBUG} -O0 ${DEBUG_INFO_FLAGS} -fno-inline ${CMAKE_CXX_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS                       </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS} ${COMPILER_FLAGS} ${CMAKE_C_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS_RELWITHDEBINFO        </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS_RELWITHDEBINFO} -O3 ${DEBUG_INFO_FLAGS} ${CMAKE_C_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS_DEBUG                 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS_DEBUG} -O0 ${DEBUG_INFO_FLAGS} -fno-inline ${CMAKE_C_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_ASM_FLAGS                     </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_ASM_FLAGS} ${COMPILER_FLAGS} ${CMAKE_ASM_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_ASM_FLAGS_RELWITHDEBINFO      </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_ASM_FLAGS_RELWITHDEBINFO} -O3 ${DEBUG_INFO_FLAGS} ${CMAKE_ASM_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_ASM_FLAGS_DEBUG               </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_ASM_FLAGS_DEBUG} -O0 ${DEBUG_INFO_FLAGS} -fno-inline ${CMAKE_ASM_FLAGS_ADD}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (COMPILER_CLANG)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_DARWIN)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -stdlib=libc++&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} -Wl,-U,_inside_main&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Display absolute paths in error messages. Otherwise KDevelop fails to navigate to correct file and opens a new file instead.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fdiagnostics-absolute-paths&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_C_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS} -fdiagnostics-absolute-paths&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ENABLE_TESTS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SANITIZE)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # https://clang.llvm.org/docs/ThinLTO.html</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Applies to clang only.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Disabled when building with tests or sanitizers.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_THINLTO </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Clang-specific link time optimization&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fstrict-vtable-pointers&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Set new experimental pass manager, it's a performance, build time and binary size win.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Can be removed after https://reviews.llvm.org/D66490 merged and released to at least two versions of clang.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -fexperimental-new-pass-manager&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_C_FLAGS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS} -fexperimental-new-pass-manager&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # We cannot afford to use LTO when compiling unit tests, and it's not enough</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # to only supply -fno-lto at the final linking stage. So we disable it</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # completely.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_THINLTO </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ENABLE_TESTS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SANITIZE)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Link time optimization</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS_RELWITHDEBINFO </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS_RELWITHDEBINFO} -flto=thin -fwhole-program-vtables&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS_RELWITHDEBINFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS_RELWITHDEBINFO} -flto=thin -fwhole-program-vtables&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS_RELWITHDEBINFO} -flto=thin -fwhole-program-vtables&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_THINLTO)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RECONFIGURE_MESSAGE_LEVEL}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Cannot enable ThinLTO&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_THINLTO)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${RECONFIGURE_MESSAGE_LEVEL}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ThinLTO is only available with Clang&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Turns on all external libs like s3, kafka, ODBC, ...</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_LIBRARIES </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable all external libraries by default&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Increase stack size on Musl. We need big stack for our recursive-descend parser.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_MUSL)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} -Wl,-z,stack-size=2097152&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cmake/dbms_glob_sources.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_library</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global-group </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INTERFACE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_LINUX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_ANDROID)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cmake/linux/default_libs.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_DARWIN)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cmake/darwin/default_libs.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_FREEBSD)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cmake/freebsd/default_libs.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global-group)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_LINUX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_DARWIN))</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Using system libs can cause a lot of warnings in includes (on macro expansion).</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WERROR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable -Werror compiler option&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(WERROR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable -Werror compiler option&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (WERROR)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Don't pollute CMAKE_CXX_FLAGS with -Werror as it will break some CMake checks.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Instead, adopt modern cmake usage requirement.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_compile_options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global-group </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INTERFACE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;-Werror&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Make this extra-checks for correct library dependencies.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_LINUX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SANITIZE)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_link_options(global-group </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INTERFACE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;LINKER:--no-undefined&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">######################################</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### Add targets below this comment ###</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">######################################</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_POSTFIX_VARIABLE </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMAKE_${CMAKE_BUILD_TYPE_UC}_POSTFIX&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (USE_STATIC_LIBRARIES)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_POSITION_INDEPENDENT_CODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OFF</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (OS_LINUX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ARCH_AARCH64)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Slightly more efficient code can be generated</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # It's disabled for ARM because otherwise ClickHouse cannot run on Android.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS_RELWITHDEBINFO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS_RELWITHDEBINFO} &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CMAKE_C_FLAGS_RELWITHDEBINFO </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_C_FLAGS_RELWITHDEBINFO} &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_POSITION_INDEPENDENT_CODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # This is required for clang on Arch linux, that uses PIE by default.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # See enable-SSP-and-PIE-by-default.patch [1].</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #   [1]: https://github.com/archlinux/svntogit-packages/blob/6e681aa860e65ad46a1387081482eb875c2200f2/trunk/enable-SSP-and-PIE-by-default.patch</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_EXE_LINKER_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_EXE_LINKER_FLAGS} &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_TESTS)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unit tests are enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Unit tests are disabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">enable_testing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable for tests without binary</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># when installing to /usr - place configs to /etc but for /usr/local place to /usr/local/etc</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_INSTALL_PREFIX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/usr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CLICKHOUSE_ETC_DIR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/etc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CLICKHOUSE_ETC_DIR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_INSTALL_PREFIX}/etc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Building for: ${CMAKE_SYSTEM} ${CMAKE_SYSTEM_PROCESSOR} ${CMAKE_LIBRARY_ARCHITECTURE} ;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    USE_STATIC_LIBRARIES=${USE_STATIC_LIBRARIES}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    SPLIT_SHARED_LIBRARIES=${SPLIT_SHARED_LIBRARIES}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GNUInstallDirs)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When testing for memory leaks with Valgrind, don't link tcmalloc or jemalloc.</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TARGET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global-group)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (EXPORT global DESTINATION cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (contrib </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">EXCLUDE_FROM_ALL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ENABLE_JEMALLOC)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (WARNING </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Non default allocator is disabled. This is not recommended for production builds.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">macro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (clickhouse_add_executable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # invoke built-in add_executable</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # explicitly acquire and interpose malloc symbols by clickhouse_malloc</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # if GLIBC_COMPATIBILITY is ON and ENABLE_THINLTO is on than provide memcpy symbol explicitly to neutrialize thinlto's libcall generation.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ARCH_AMD64 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GLIBC_COMPATIBILITY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ENABLE_THINLTO)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${ARGV}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $&lt;TARGET_OBJECTS:clickhouse_malloc> $&lt;TARGET_OBJECTS:memcpy>)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${ARGV}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $&lt;TARGET_OBJECTS:clickhouse_malloc>)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    get_target_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${type}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXECUTABLE)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # disabled for TSAN and gcc since libtsan.a provides overrides too</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TARGET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clickhouse_new_delete)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # operator::new/delete for executables (MemoryTracker stuff)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clickhouse_new_delete)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # In case of static jemalloc, because zone_register() is located in zone.c and</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # is never used outside (it is declared as constructor) it is omitted</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # by the linker, and so jemalloc will not be registered as system</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # allocator under osx [1], and clickhouse will SIGSEGV.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #   [1]: https://github.com/jemalloc/jemalloc/issues/708</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # About symbol name:</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # - _zone_register not zone_register due to Mach-O binary format,</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # - _je_zone_register due to JEMALLOC_PRIVATE_NAMESPACE=je_ under OS X.</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # - but jemalloc-cmake does not run private_namespace.sh</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #   so symbol name should be _zone_register</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_JEMALLOC </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USE_STATIC_LIBRARIES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OS_DARWIN)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TARGET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${target}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> APPEND PROPERTY LINK_OPTIONS -u_zone_register)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endmacro</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># With cross-compiling, all targets are built for the target platform which usually different from the host</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># platform. This is problematic if a build artifact X (e.g. a file or an executable) is generated by running</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># another executable Y previously produced in the build. This is solved by compiling and running Y for/on</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the host platform. Add target to the list:</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#    add_native_target(&lt;target> ...)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GLOBAL PROPERTY NATIVE_BUILD_TARGETS)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (add_native_target)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GLOBAL APPEND PROPERTY NATIVE_BUILD_TARGETS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${ARGV}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endfunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (add_native_target)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ConfigIncludePath </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${CMAKE_CURRENT_BINARY_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/includes/configs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CACHE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INTERNAL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Path to generated configuration files.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${ConfigIncludePath}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add as many warnings as possible for our own code.</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/warnings.cmake)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/print_flags.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (base)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (src)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (programs)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (tests)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_subdirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (utils)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cmake/sanitize_target_link_libraries.cmake)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Build native targets if necessary</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get_property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(NATIVE_BUILD_TARGETS GLOBAL PROPERTY NATIVE_BUILD_TARGETS)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (NATIVE_BUILD_TARGETS</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        CMAKE_HOST_SYSTEM_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CMAKE_SYSTEM_NAME</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        AND</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CMAKE_HOST_SYSTEM_PROCESSOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> STREQUAL</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CMAKE_SYSTEM_PROCESSOR</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Building native targets...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (NATIVE_BUILD_DIR </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${CMAKE_BINARY_DIR}/native&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    execute_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        COMMAND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_COMMAND}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> -E make_directory </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${NATIVE_BUILD_DIR}&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        COMMAND_ECHO STDOUT)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    execute_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        COMMAND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_COMMAND}</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;-DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}&quot;</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;-DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}&quot;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        ${CMAKE_SOURCE_DIR}</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        WORKING_DIRECTORY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${NATIVE_BUILD_DIR}&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        COMMAND_ECHO STDOUT)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    execute_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        COMMAND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_COMMAND}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --build </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${NATIVE_BUILD_DIR}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${NATIVE_BUILD_TARGETS}</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        COMMAND_ECHO STDOUT)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ENABLE_PBKDF2 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Enable PBKDF2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 0)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ENABLE_PBKDF2)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_definitions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-DENABLE_PBKDF2=1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DISABLE_HTTP </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disable HTTP Protocl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 0)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (DISABLE_HTTP)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_definitions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-DISABLE_HTTP=1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DISABLE_MEMCPY </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disable memcpy_jart&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 0)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (DISABLE_MEMCPY)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_definitions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-DISABLE_MEMCPY=1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></figure>
<p>我们从一个简单的CMakeLists.txt开始：</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="cmake" data-theme="github-light github-dark"><code data-language="cmake" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cmake_minimum_required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3.20)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GREDialing </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 0.1)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMake version: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_VERSION}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_VERSION}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VERSION_LESS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;3.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD 17)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD_REQUIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Checking compiler flags for C++11 support.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Set C++11 support flags for various compilers</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CheckCXXCompilerFlag)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    check_cxx_compiler_flag(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-std=c++11&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_SUPPORTS_CXX11)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    check_cxx_compiler_flag(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-std=c++0x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPILER_SUPPORTS_CXX0X)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_SUPPORTS_CXX11)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;C++11 is supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${CMAKE_SYSTEM_NAME}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Darwin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -std=c++11 -stdlib=libc++&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -std=c++11&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(COMPILER_SUPPORTS_CXX0X)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;C++0x is supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${CMAKE_SYSTEM_NAME}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MATCHES</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Darwin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -std=c++0x -stdlib=libc++&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">CMAKE_CXX_FLAGS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CXX_FLAGS} -std=c++0x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The compiler ${CMAKE_CXX_COMPILER} has no C++11 support. Please use a different C++ compiler.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 禁止 C++ assert terminate 程序</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_definitions(-DNDEBUG)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ASIO 不使用 Boost 库</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#add_definitions(-DASIO_STANDALONE)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Spdlog 使用外部 Fmt 库</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#add_definitions(-DSPDLOG_FMT_EXTERNAL)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Jwt-cpp 使用外部 Json 库</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ADD_DEFINITIONS(-DJWT_CPP_JSON_EXTERNAL)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_definitions(-DGLOG_ON)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成编译命令文件，给 YCM/Clangd 使用</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_EXPORT_COMPILE_COMMANDS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD_COMPILE_OPTIONS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-g)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设置输出目录</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${PROJECT_SOURCE_DIR}/bin)</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#加入包含目录</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># include_directories(${CMAKE_CURRENT_SOURCE_DIR}/service/src/main/cpp/decryptSDK/include) </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(decryptSDK/include) </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(/home/hubingbing/rapidjson/include)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(/home/hubingbing/concurrentqueue)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># include_directories(/opt/Euler_compile_env/usr/src/kernels/4.19.90-vhulk2107.1.0.h699.eulerosv2r10.aarch64/include)</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#静态库目录</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#link_directories(/usr/lib64/mysql)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#logger lib </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#add_subdirectory(decryptSDK)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># aux_source_directory(decryptSDK SRCS) #加入目录下所有源码</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_executable(demo ${SRCS}) #生成可执行文件</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># target_link_libraries(demo logger)  #链接logger库</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">EXECUTABLE_OUTPUT_PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CURRENT_SOURCE_DIR}/build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;binary dir is ${EXECUTABLE_OUTPUT_PATH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_SCRATCH_TARGET 0)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_SCRATCH_TARGET)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GLOB_RECURSE scratch_srcs scratch/*.cpp)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # message(STATUS &quot;all scratchs: ${scratch_srcs}&quot;)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(srcfile IN LISTS scratch_srcs)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Get file name without directory</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        get_filename_component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elfname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${srcfile}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NAME_WE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${elfname} .. ${srcfile}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${elfname}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${srcfile}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${elfname}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pthread)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endforeach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_executable(main ../main.cpp)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_executable(server udp_server.cpp) </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_executable(ConfigReader ConfigReader.cpp) </span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># add_executable(packet_handler packet_handler.cpp)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_MAIN_TARGET 1)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_MAIN_TARGET)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> main)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(src_lst main.cpp ConfigReader.cpp packet_handler.cpp SslClient.cpp packet.cpp)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${src_lst}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    aux_source_directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(decryptSDK KMC_DIR)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${KMC_DIR}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /home/hubingbing/cloud-frame-kmc/include/)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_link_directories(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /home/hubingbing/cloud-frame-kmc/lib_so/)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kmcjni)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl crypto pthread)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># target_link_libraries(debug pthread)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># target_link_libraries(server pthread)</span></span></code></pre></figure>
<p>上面的cmake也不算太简单，我们再简化一下：</p>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="cmake" data-theme="github-light github-dark"><code data-language="cmake" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">cmake_minimum_required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 3.20)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">project</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GREDialing </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VERSION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 0.1)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CMake version: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${CMAKE_VERSION}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD 17)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_CXX_STANDARD_REQUIRED </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成编译命令文件，给 YCM/Clangd 使用</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CMAKE_EXPORT_COMPILE_COMMANDS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 附加调试信息</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD_COMPILE_OPTIONS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(-g)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#加入包含目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(decryptSDK/include) </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(/home/yychi/rapidjson/include)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(/home/yychi/concurrentqueue)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加入./decryptSDK目录下所有源码并赋到SRCS变量中</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 后续可用$SRCS使用该变量</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">aux_source_directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(decryptSDK SRCS) </span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(demo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${SRCS}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#生成可执行文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(demo logger)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#链接logger库</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">EXECUTABLE_OUTPUT_PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;${CMAKE_CURRENT_SOURCE_DIR}/build&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;binary dir is ${EXECUTABLE_OUTPUT_PATH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_SCRATCH_TARGET 0)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_SCRATCH_TARGET)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 递归找到./scratch目录下所有cpp文件，赋值给scratch_srcs变量</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GLOB_RECURSE scratch_srcs scratch/*.cpp)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # message(STATUS &quot;all scratchs: ${scratch_srcs}&quot;)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(srcfile IN LISTS scratch_srcs)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # Get file name without directory</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        get_filename_component</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(elfname </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${srcfile}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NAME_WE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(STATUS </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;${elfname} .. ${srcfile}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${elfname}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${srcfile}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${elfname}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pthread)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    endforeach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span data-line> </span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_MAIN_TARGET 1)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BUILD_MAIN_TARGET)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> main)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(src_lst main.cpp a.cpp b.cpp c.cpp d.cpp)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    add_executable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${src_lst}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    aux_source_directory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(decryptSDK descrypt_srcs)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为target增加要编译的源文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ${descrypt_srcs}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为target增加include目录</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_include_directories</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /home/yychi/cloud/include/)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为target增加动态库/静态库搜索路径</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_link_directories(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PRIVATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /home/yychi/frame/lib_so/)</span></span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 为target链接库文件</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    target_link_libraries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${target}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl crypto pthread)</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">endif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></figure>
<p>通常的，一个CMakeLists.txt中必须包含至少一个target，target可以是动态库/静态库/可执行文件。当定义了target之后，推荐使用</p>
<ul>
<li>target_sources</li>
<li>target_include_directories</li>
<li>target_link_directories</li>
<li>target_link_options</li>
<li>target_link_libraries</li>
<li>target_compile_options</li>
<li>target_compile_definitions</li>
<li>target_compile_features</li>
</ul>
<p>而非</p>
<ul>
<li>include_directories</li>
<li>link_directories</li>
<li>add_compile_options</li>
<li>add_link_options</li>
</ul>
<p>等全局函数。</p>
<h2 id="变量">变量<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#变量" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="cmake" data-theme="github-light github-dark"><code data-language="cmake" data-theme="github-light github-dark" style="display:grid;"><span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(&lt;variable> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">>) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set value to variable</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">${variable}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # take the value of variable</span></span></code></pre></figure>
<blockquote class="callout note" data-callout="note">
<div class="callout-title">
                  <div class="callout-icon"></div>
                  <div class="callout-title-inner"><p>Note</p></div>
                  
                </div>
<div class="callout-content">
<p>CMake语言不区分大小写，但是参数区分大小写。</p>
</div>
</blockquote>
<h2 id="references">References<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#references" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li><a href="https://www.ljjyy.com/archives/2021/03/100652.html" class="external">CMake 完整使用教程 之二 从可执行文件到库<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
</ol></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>关系图谱</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-43" aria-expanded="true"><h3>目录</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#变量" data-for="变量">变量</a></li><li class="depth-0"><a href="#references" data-for="references">References</a></li><li class="overflow-end"></li></ul></div><div class="backlinks"><h3>反向链接</h3><ul id="list-2" class="overflow"><li><a href="../__zettel/202306262103cmake-template" class="internal">202306262103</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2025 ❤️ Yychi</p><ul></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../postscript.js" type="module"></script></html>